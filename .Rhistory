pacman::p_load(here, arrow, tidyverse, lavaan, microbenchmark, magrittr)
set.seed(123)
#setwd(r"(C:\Users\maxim\.julia\dev\sem)")
#----lavaan----
model <- three_path =
"# measurement model
ind60 =~ x1 + x2 + x3
dem60 =~ y1 + y2 + y3 + y4
dem65 =~ y5 + y6 + y7 + y8
# regressions
dem60 ~ ind60
dem65 ~ ind60 + dem60
# residual correlations
y1 ~~ y5
y2 ~~ y4 + y6
y3 ~~ y7
y4 ~~ y8
y6 ~~ y8"
data <- PoliticalDemocracy
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = FALSE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = FALSE)
#----lavaan----
model <-    "# measurement model
ind60 =~ x1 + x2 + x3
dem60 =~ y1 + y2 + y3 + y4
dem65 =~ y5 + y6 + y7 + y8
# regressions
dem60 ~ ind60
dem65 ~ ind60 + dem60
# residual correlations
y1 ~~ y5
y2 ~~ y4 + y6
y3 ~~ y7
y4 ~~ y8
y6 ~~ y8"
data <- PoliticalDemocracy
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = FALSE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = FALSE)
V.mean <- lavInspect(fit_ls, "WLS.V")
V.mean
data <- PoliticalDemocracy
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = FALSE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = FALSE)
V.mean <- lavInspect(fit_ls, "WLS.V")
fit_ml <- cfa(fit_ml, likelihood = "wishart")
fit_ls <- cfa(fit_ls, estimator = "WLS")
summary(fit_ml)
fit_ml <- cfa(fit_ml, likelihood = "wishart", do.fit = TRUE)
fit_ls <- cfa(fit_ls, estimator = "WLS", do.fit = TRUE)
summary(fit_ml)
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = TRUE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE)
summary(fit_ml)
summary(fit_ls)
par_ml <- select(parameterEstimates(fit_ml), lhs, op, rhs, est, se, p = pvalue, z, start)
parTable(fit_ml)
par_ml <- select(parTable(fit_ml), lhs, op, rhs, est, se, p = pvalue, z, start)
par_ml <- select(parTable(fit_ml), lhs, op, rhs, est, se, z, start)
par_ml <- select(parTable(fit_ml), lhs, op, rhs, est, start)
write_arrow(par_ml, str_c("test/comparisons/par_dem_ml.arrow")))
write_arrow(par_ml, str_c("test/comparisons/par_dem_ml.arrow"))
setwd(r"(C:\Users\maxim\.julia\dev\sem)
")"
""
setwd(r"(C:\Users\maxim\.julia\dev\sem)")
write_arrow(par_ml, str_c("test/comparisons/par_dem_ml.arrow"))
write_arrow(par_ls, str_c("test/comparisons/par_dem_ls.arrow"))
par_ls <- select(parTable(fit_ls), lhs, op, rhs, est, start)
write_arrow(par_ls, str_c("test/comparisons/par_dem_ls.arrow"))
write_arrow(data, str_c("test/comparisons/data_dem.arrow"))
obs_voc = cov(data)
obs_cov
obs_cov <- cov(data)
obs_cov
obs_cov <- solve(obs_cov)
kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(5)
L
obs_cov <- kronecker(obs_cov, obs_cov)
obs_cov
L <- lavaan::lav_matrix_duplication(11)
L*obs_cov*L
L
?dim
dim(L)
dim(obs_cov)
t(L)*obs_cov*L
L*obs_cov*t(L)
dim(t(L))
t(L)%*%obs_cov%*%L
W <- t(L)%*%obs_cov%*%L
1:9
V <- V.mean[-1:11, -1:11]
c(1:9)
V <- V.mean[-c(1:11), -c(1:11)]
dim(V)
dim(W)
V.mean <- lavInspect(fit_ls, "WLS.V")
dim(V)
V <- lavInspect(fit_ls, "WLS.V")
dim(V)
11*12
66*2
W == V
sum(W == V)
W
V
W
?cov
obs_cov <- cov(data)
obs_cov <- solve(obs_cov)
obs_cov <- kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(11)
W <- t(L)%*%obs_cov%*%L
L*obs_cov*L
W
obs_cov <- cov(data)
obs_cov <- solve(obs_cov)
obs_cov <- kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(11)
W <- t(L)%*%obs_cov%*%L
W
V
W
V
W
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = W)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = 0.5*W)
K = L%*%solve(t(L)%*%L)
K
obs_cov <- cov(data)
obs_cov <- kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(11)
W <- t(L)%*%obs_cov%*%L
W
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = 0.5*W)
W
solve(S)
obs_cov <- cov(data)
solve(obs_cov)
obs_cov <- cov(data)
obs_cov <- kronecker(obs_cov, obs_cov)
W <- t(L)%*%obs_cov%*%L
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = 0.5*W)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = diag(55))
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = diag(66))
summary(fit_ls)
summary(fit_ml)
solve(S)
pacman::p_load(here, arrow, tidyverse, lavaan, microbenchmark, magrittr)
set.seed(123)
#setwd(r"(C:\Users\maxim\.julia\dev\sem)")
#----lavaan----
model <-    "# measurement model
ind60 =~ x1 + x2 + x3
dem60 =~ y1 + y2 + y3 + y4
dem65 =~ y5 + y6 + y7 + y8
# regressions
dem60 ~ ind60
dem65 ~ ind60 + dem60
# residual correlations
y1 ~~ y5
y2 ~~ y4 + y6
y3 ~~ y7
y4 ~~ y8
y6 ~~ y8"
data <- PoliticalDemocracy
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = FALSE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = FALSE,  WLS.V = diag(66))
V <- lavInspect(fit_ls, "WLS.V")
#V <- V[-c(1:11), -c(1:11)]
obs_cov <- cov(data)
obs_cov <- solve(obs_cov)
obs_cov <- kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(11)
W <- t(L)%*%obs_cov%*%L
K = L%*%solve(t(L)%*%L)
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = TRUE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = diag(66))
par_ml <- select(parTable(fit_ml), lhs, op, rhs, est, start)
par_ls <- select(parTable(fit_ls), lhs, op, rhs, est, start)
write_arrow(par_ml, str_c("test/comparisons/par_dem_ml.arrow"))
write_arrow(par_ls, str_c("test/comparisons/par_dem_ls.arrow"))
write_arrow(data, str_c("test/comparisons/data_dem.arrow"))
solve(V)
V
V <- lavInspect(fit_ls, "WLS.V")
V
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE)#, WLS.V = diag(66))
V
V <- lavInspect(fit_ls, "WLS.V")
V
solve(V)
obs_cov <- cov(data)
obs_cov <- kronecker(obs_cov, obs_cov)
W <- t(L)%*%obs_cov%*%L
W
W
solve(V)
W
V
solve(V)
0.5*W
W
V
solve(V)
pacman::p_load(here, arrow, tidyverse, lavaan, microbenchmark, magrittr)
set.seed(123)
#setwd(r"(C:\Users\maxim\.julia\dev\sem)")
#----lavaan----
model <-    "# measurement model
ind60 =~ x1 + x2 + x3
dem60 =~ y1 + y2 + y3 + y4
dem65 =~ y5 + y6 + y7 + y8
# regressions
dem60 ~ ind60
dem65 ~ ind60 + dem60
# residual correlations
y1 ~~ y5
y2 ~~ y4 + y6
y3 ~~ y7
y4 ~~ y8
y6 ~~ y8"
data <- PoliticalDemocracy
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = FALSE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = FALSE,  WLS.V = diag(66))
V <- lavInspect(fit_ls, "WLS.V")
#V <- V[-c(1:11), -c(1:11)]
obs_cov <- cov(data)
obs_cov <- solve(obs_cov)
obs_cov <- kronecker(obs_cov, obs_cov)
L <- lavaan::lav_matrix_duplication(11)
W <- t(L)%*%obs_cov%*%L
K = L%*%solve(t(L)%*%L)
fit_ml <- cfa(model, data, likelihood = "wishart", do.fit = TRUE)
fit_ls <- cfa(model, data, estimator = "WLS", do.fit = TRUE, WLS.V = diag(66))
par_ml <- select(parTable(fit_ml), lhs, op, rhs, est, start)
par_ls <- select(parTable(fit_ls), lhs, op, rhs, est, start)
write_arrow(par_ml, str_c("test/comparisons/par_dem_ml.arrow"))
write_arrow(par_ls, str_c("test/comparisons/par_dem_ls.arrow"))
write_arrow(data, str_c("test/comparisons/data_dem.arrow"))
par_ls
fit_ml
